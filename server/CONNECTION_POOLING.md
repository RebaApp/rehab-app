# üîÑ Connection Pooling –¥–ª—è Prisma - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

## ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω **Connection Pooling** –¥–ª—è Prisma Client, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —É—Ç–µ—á–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∏ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

### –ü—Ä–æ–±–ª–µ–º–∞ (–î–û):
- ‚ùå –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–≤–∞–ª —Å–≤–æ–π `PrismaClient`
- ‚ùå –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–≥ —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- ‚ùå –£—Ç–µ—á–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ø—Ä–∏ –Ω–∞–≥—Ä—É–∑–∫–µ
- ‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π PostgreSQL

### –†–µ—à–µ–Ω–∏–µ (–ü–û–°–õ–ï):
- ‚úÖ –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä `PrismaClient` –¥–ª—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π connection pooling
- ‚úÖ Graceful shutdown –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üìÅ –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –°–æ–∑–¥–∞–Ω:
- `server/src/utils/prisma.js` - Singleton PrismaClient

### –û–±–Ω–æ–≤–ª–µ–Ω—ã:
- `server/src/routes/auth.js`
- `server/src/routes/centers.js`
- `server/src/routes/articles.js`
- `server/src/routes/bookings.js`
- `server/src/routes/users.js`
- `server/src/middleware/auth.js`
- `server/src/seed.js`

## üîß –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–æ (–ø–ª–æ—Ö–æ):
```javascript
// –í –∫–∞–∂–¥–æ–º —Ñ–∞–π–ª–µ:
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient(); // ‚ùå –ù–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–∞–∂–¥—ã–π —Ä–∞–∑
```

### –ü–æ—Å–ª–µ (—Ö–æ—Ä–æ—à–æ):
```javascript
// –í –∫–∞–∂–¥–æ–º —Ñ–∞–π–ª–µ:
const prisma = require('../utils/prisma'); // ‚úÖ –û–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä –¥–ª—è –≤—Å–µ—Ö
```

### Singleton —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```javascript
// server/src/utils/prisma.js
const { PrismaClient } = require('@prisma/client');

const prisma = new PrismaClient({
  log: process.env.NODE_ENV === 'development' 
    ? ['query', 'info', 'warn', 'error'] 
    : ['error'],
});

// Graceful shutdown
process.on('beforeExit', async () => {
  await prisma.$disconnect();
});

module.exports = prisma;
```

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - –ú–µ–Ω—å—à–µ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - –ë—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—Ç—ã API

2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**
   - –ù–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ª–∏–º–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π PostgreSQL
   - –†–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–∞–º–∏

3. **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**
   - –ù–µ—Ç —É—Ç–µ—á–µ–∫ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - Graceful shutdown
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞

–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**
   ```bash
   cd server
   npm start
   ```

2. **API —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   ```bash
   curl http://localhost:3001/health
   ```

3. **–ù–µ—Ç –æ—à–∏–±–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
   - –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–µ –æ—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Connection Pool

Prisma –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç connection pooling —á–µ—Ä–µ–∑ `DATABASE_URL`.

–î–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—É–ª–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `DATABASE_URL`:

```
postgresql://user:password@host:5432/db?connection_limit=10&pool_timeout=20
```

–ì–¥–µ:
- `connection_limit` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ë–î)
- `pool_timeout` - —Ç–∞–π–º–∞—É—Ç –æ–∂–∏–¥–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–î–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
const result = await prisma.$queryRaw`
  SELECT count(*) FROM pg_stat_activity 
  WHERE datname = current_database();
`;
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [Prisma Connection Management](https://www.prisma.io/docs/concepts/components/prisma-client/working-with-prismaclient/connection-management)
- [PostgreSQL Connection Pooling](https://www.postgresql.org/docs/current/runtime-config-connection.html)

---

**–ì–æ—Ç–æ–≤–æ!** Connection Pooling –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç! üöÄ


